
### ERD (Entity Relation Diagram)
- 데이터베이스 구축할 때 가장 기초적인 뼈대 역할을 함
- 릴레이션 간의 관계들을 정의한 것
- 비정형 데이터를 충분히 표현할 수 없다는 단점이 있음



### 정규화 (Normalization)

이상현상이 있는 릴레이션을 분해하여 이상현상(Anomaly)을 없애는 과정
즉, 중복을 최소화하게 데이터를 구조화하는 프로세스

>**정규화의 기본 목표**
>관련이 없는 함수 종속성은 별개의 릴레이션으로 표현하는 것

**장점**
- 데이터베이스 변경 시 이상 현상(Anomaly)을 제거할 수 있다.

**단점**
- 릴레이션의 분해로 인해 릴레이션 간의 JOIN연산이 많아진다. -> 연산 시간이 증가한다. -> 반정규화가 해답이 될 수도 있음

![[Pasted image 20230303030049.png]]


#### **제1정규형 (1NF)**
- 각 컬럼이 하나의 속성만을 가져야 한다.  
- 하나의 컬럼은 같은 종류나 타입(type)의 값을 가져야 한다.  
- 각 컬럼이 유일한(unique) 이름을 가져야 한다.  
- 칼럼의 순서가 상관없어야 한다.

![[Pasted image 20230303025149.png]]



#### **제2정규형(2NF)**
- 1정규형을 만족해야 한다.  
- 모든 컬럼이 부분적 종속(Partial Dependency)이 없어야 한다. == 모든 칼럼이 완전 함수 종속을 만족해야 한다.
- 즉, 부분 함수의 종속성을 제거한 형태 

> **부분 함수의 종속성 제거란?**
> 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것을 말함

![[Pasted image 20230303025541.png]]



#### **제3정규형(3NF)**

- 제2정규형을 만족해야 한다.
- 기본키를 제외한 속성들 간의 이행적 함수 종속이 없어야 한다.

> **이행적 함수 종속 (Transitive Function Dependency)**
> A → B와 B → C가 존재하면 논리적으로 A → C가 성립하는데, 이때 집합 C가 집합 A에 *이행적으로 함수 종속*이 되었다고 함

![[Pasted image 20230303030852.png]]



#### 보이스/코드 정규형 (BCNF)

- 3정규형을 만족해야 한다.  
- 모든 결정자가 후보키 집합에 속해야 한다.

>**결정자**
>함수 종속 관계에서 특정 종속자를 결정짓는 요소
>X → Y일 때, X는 결정자, Y는 종속자이다.

![[Pasted image 20230303031348.png]]
![[Pasted image 20230303032130.png]]
>강사 속성이 결정자이지만 후보키가 아니므로 이 강사 속성을 분리해야 한다.


![[Pasted image 20230303032307.png]]



---


## 트랜잭션과 무결성

#### 트랜잭션
: 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위

- 즉, 여러 개의 쿼리들을 하나로 묶는 단위
- ACID : 원자성, 일관성, 독립성, 지속성이 있음

**Atomicity (원자성)**
: 트랜잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장하는 특징
- all or nothing
- 트랜잭션을 커밋했는데, 문제가 발생하는 경우 그 이후에 모두 수행되지 않음을 보장하는 것

>**스프링에서 `@Transactional`을 이용한 트랜잭션 전파**
>여러 쿼리 관련 코드들을 하나의 트랜잭션으로 처리함


**Consistency (일관성)**
: 허용된 방식으로만 데이터를 변경해야 하는 것. 데이터베이스의 상태가 일관되어야 한다는 성질
- 하나의 트랜잭션 이전과 이후, 데이터베이스의 상태는 이전과 같이 유효해야 한다.


**Isolation (격리성, 고립성)**
: 모든 트랜잭션은 다른 트랜잭션으로부터 독립되어야 한다.
- 실제로 동시에 여러 개의 트랜잭션들이 수행될 때, 각 트랜잭션은 고립/격리되어 있어 연속으로 실행된 것과 동일한 결과를 나타냄

![[Pasted image 20230303040223.png]]

- 격리 수준에 따라 발생하는 현상
	- Phantom Read (팬텀 리드) : 한 트랜잭션 내에서 동일한 쿼리를 보냈을 때 해당 조회 결과가 다른 경우
	- Non-repeatable Readd (반복 가능하지 않은 조회) : 한 트랜잭션 내의 같은 행에 두 번 이상 조회가 발생하였는데, 그 값이 다른 경우. 팬텀리드와 다른 점 : 팬텀 리드는 다른 행이 선택될 수도 있는 반면, 이 때는 다른 행이 선택될 수도 있음
	- Dirty Read (더티 리드) : 한 트랜잭션이 실행 중일 때 다른 트랜잭션에 의해 수정되었지만 아직 커밋되지 않은 행의 데이터를 읽는 것
= 
- 격리 수준
	- Serializable : 트랜잭션을 순차적으로 진행시키는 것. 여러 트랜잭션이 동시에 같은 행에 접근할 수 없음. 따라서 교착 상태가 일어날 확률도 많고, 가장 성능이 떨어지는 격리 수준임
	- Repeatable Read : 하나의 트랜잭션이 수정한 행을 다른 트랜잭션이 수정할 수 없도록 막아주지만, 새로운 행을 추가하는 것은 막지 않음
	- Read Committed : 가장 많이 사용되는 격리 수준. MySQL, PostgreSQL, SQL Server, Oracle에서 기본값으로 설정되어 있음. 다른 트랜잭션이 커밋하지 않은 정보는 읽을 수 없다. 즉, 커밋 완료된 데이터에 대해서만 조회를 허용한다.
	- Read Unommitted : 가장 낮은 격리 수준. 데이터 무결성을 위해 되도록 사용하지 않는 것이 이상적이나, 대량의 데이터를 어림잡아 집계하는 데에는 사용하면 좋음


**Durability (지속성)**
: 하나의 트랜잭션이 성공적으로 수행되었다면, 해당 트랜잭션에 대한 로그가 남아야 하는 성질

- 성공된 트랜잭션은 영원히 반영되어야 함
- 즉, 데이터베이스에 시스템 장애가 발생해도 원래 상태로 복구하는 회복 기능이 있어야 함. 이를 위해 데이터베이스는 체크섬, 저널링, 롤백 등의 기능 제공


> 체크섬 : 중복 검사의 한 형태. 오류 정정을 통해 송신된 자료의 무결성을 보호함

> 저널링 : 파일 시스템 또는 데이터베이스 시스템에 변경 사항을 반영하기 전에 로깅하는 것. 트랜잭션 등 변경 사항에 대한 로그를 남기는 것


#### **Integerity(무결성)**

: 데이터의 정확성, 일관성, 유효성을 유지하는 것

- 데이터베이스에 저장된 데이터 값과 그 값에 해당하는 현실 세계의 실제 값이 일치하는지 여부

**종류**
- 개체 무결성
- 참조 무결성
- 고유 무결성
- NULL 무결성
